<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Telepizza - Gestión de Jornadas</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <div class="container">
        <div class="logo">
            <h1>Telepizza</h1>
            <span>Gestión de Jornadas</span>
        </div>
        
        <!-- Selección de rol -->
        <div class="selector active">
            <h2>Selecciona tu rol</h2>
            <button class="btn" id="btnTelepizzero">
                <i class="fas fa-user-clock"></i> Telepizzero
            </button>
            <button class="btn" id="btnGerencia">
                <i class="fas fa-chart-line"></i> Gerencia
            </button>
        </div>
        
        <!-- Sección para telepizzeros -->
        <div class="telepizzero-section">
            <h2><i class="fas fa-user-clock"></i> Registro de Jornada</h2>
            
            <div class="permiso-geolocalizacion" id="permisoGeolocalizacion">
                <h3><i class="fas fa-map-marker-alt"></i> Activación de Geolocalización</h3>
                <p>Para registrar tu jornada, necesitamos acceder a tu ubicación.</p>
                <p>Haz clic en "Activar Geolocalización" y permite el acceso cuando tu navegador lo solicite.</p>
                <div class="loader" id="loaderGeolocalizacion" style="display: none;"></div>
                <button class="btn btn-success" id="btnActivarGeolocalizacion">
                    <i class="fas fa-location-crosshairs"></i> Activar Geolocalización
                </button>
            </div>
            
            <div id="contenidoFichaje" style="display: none;">
                <div class="form-group">
                    <label for="dniInput"><i class="fas fa-id-card"></i> Introduce tu DNI (8 dígitos)</label>
                    <input type="text" id="dniInput" placeholder="Ej: 00000000" maxlength="8" inputmode="numeric">
                    <small style="color: #FFC72C; font-size: 0.9rem;">Solo números, sin letras</small>
                </div>
                
                <button class="btn btn-success" id="btnFichar">
                    <i class="fas fa-fingerprint"></i> Fichar Entrada/Salida
                </button>
                
                <div class="geolocalizacion-info" id="infoGeolocalizacion" style="display: none;">
                    <h3><i class="fas fa-map-marker-alt"></i> Ubicación Detectada</h3>
                    <div id="estadoGeolocalizacion">Obteniendo ubicación...</div>
                    <div class="coordenadas" id="coordenadas"></div>
                    <div class="ubicacion-aproximada" id="direccionAproximada"></div>
                    <div class="mapa" id="mapaContainer">
                        <div id="mapaPlaceholder">Mapa se cargará aquí</div>
                    </div>
                </div>
                
                <div class="mensaje" id="mensajeTelepizzero"></div>
            </div>
            
            <button class="btn volver-btn" id="volverTelepizzero">
                <i class="fas fa-arrow-left"></i> Volver al Menú
            </button>
        </div>
        
        <!-- Sección para gerencia -->
        <div class="gerencia-section">
            <h2><i class="fas fa-chart-line"></i> Acceso Gerencia</h2>
            <div class="form-group">
                <label for="passwordInput"><i class="fas fa-key"></i> Contraseña</label>
                <input type="password" id="passwordInput" placeholder="Introduce la contraseña" inputmode="numeric">
            </div>
            <button class="btn" id="btnAcceder">
                <i class="fas fa-sign-in-alt"></i> Acceder
            </button>
            <div class="mensaje" id="mensajeGerencia"></div>
            <button class="btn volver-btn" id="volverGerencia">
                <i class="fas fa-arrow-left"></i> Volver
            </button>
        </div>
        
        <!-- Sección de gestión para gerencia -->
        <div class="registro-section">
            <h2><i class="fas fa-tachometer-alt"></i> Panel de Gerencia <span class="badge">En línea</span></h2>
            
            <div class="tabs">
                <div class="tab-btn active" data-tab="registros"><i class="fas fa-clipboard-list"></i> Registros</div>
                <div class="tab-btn" data-tab="usuarios"><i class="fas fa-users"></i> Usuarios</div>
                <div class="tab-btn" data-tab="ausencias"><i class="fas fa-exclamation-triangle"></i> Ausencias</div>
                <div class="tab-btn" data-tab="correo"><i class="fas fa-envelope"></i> Correo</div>
                <div class="tab-btn" data-tab="semanas"><i class="fas fa-calendar-week"></i> Semanas</div>
            </div>
            
            <!-- Pestaña de Registros -->
            <div class="tab-content active" id="registros-tab">
                <h3><i class="fas fa-clipboard-list"></i> Registro de Jornadas</h3>
                
                <div class="filtros">
                    <select id="filtroPuesto">
                        <option value="">Todos los puestos</option>
                        <option value="auxiliar">Auxiliar de Tienda</option>
                        <option value="repartidor">Repartidor</option>
                        <option value="encargado">Encargado</option>
                        <option value="limpieza">Limpieza</option>
                    </select>
                    
                    <!-- Selector de vista: Semana, Día o Rango -->
                    <select id="filtroVista">
                        <option value="semana">Ver semana actual</option>
                        <option value="dia">Ver día específico</option>
                        <option value="rango">Ver rango de fechas</option>
                    </select>
                    
                    <!-- Selector de semana -->
                    <div id="selectorSemana" class="selector-fecha">
                        <input type="week" id="filtroSemana">
                    </div>
                    
                    <!-- Selector de día -->
                    <div id="selectorDia" class="selector-fecha" style="display: none;">
                        <input type="date" id="filtroDia">
                    </div>
                    
                    <!-- Selector de rango -->
                    <div id="selectorRango" class="selector-fecha" style="display: none;">
                        <input type="date" id="filtroDesde" placeholder="Desde">
                        <input type="date" id="filtroHasta" placeholder="Hasta">
                    </div>
                    
                    <button class="btn btn-secondary" id="btnFiltrar">
                        <i class="fas fa-filter"></i> Filtrar
                    </button>
                    <button class="btn btn-gris" id="btnResetFiltros">
                        <i class="fas fa-redo"></i> Reset
                    </button>
                </div>
                
                <div class="table-responsive">
                    <table id="tablaRegistros">
                        <thead>
                            <tr>
                                <th><i class="fas fa-user"></i> Nombre</th>
                                <th><i class="fas fa-id-card"></i> DNI</th>
                                <th><i class="fas fa-briefcase"></i> Puesto</th>
                                <th><i class="fas fa-calendar-day"></i> Fecha</th>
                                <th><i class="fas fa-sign-in-alt"></i> Entrada</th>
                                <th><i class="fas fa-sign-out-alt"></i> Salida</th>
                                <th><i class="fas fa-clock"></i> Horas</th>
                                <th><i class="fas fa-map-marker-alt"></i> Ubicación</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Los registros se llenarán con JavaScript -->
                        </tbody>
                    </table>
                </div>
                
                <div class="total-horas" id="totalHoras"></div>
                
                <div class="botones-reporte">
                    <button class="btn btn-reporte" id="btnEnviarReporteDiario">
                        <i class="fas fa-file-pdf"></i> Reporte Diario PDF
                    </button>
                    <button class="btn btn-reporte" id="btnEnviarReporteSemanal">
                        <i class="fas fa-file-pdf"></i> Reporte Semanal PDF
                    </button>
                    <button class="btn btn-gris" id="btnEnviarReporteMensual">
                        <i class="fas fa-file-pdf"></i> Reporte Mensual PDF
                    </button>
                </div>
            </div>
            
            <!-- Pestaña de Gestión de Usuarios -->
            <div class="tab-content" id="usuarios-tab">
                <h3><i class="fas fa-users"></i> Gestión de Telepizzeros</h3>
                
                <div class="form-group">
                    <label for="nuevoDni"><i class="fas fa-id-card"></i> DNI (8 dígitos)</label>
                    <input type="text" id="nuevoDni" placeholder="Ej: 00000000" maxlength="8" inputmode="numeric">
                    
                    <label for="nuevoNombre"><i class="fas fa-user"></i> Nombre completo</label>
                    <input type="text" id="nuevoNombre" placeholder="Ej: Juan Pérez">
                    
                    <label for="nuevoPuesto"><i class="fas fa-briefcase"></i> Puesto</label>
                    <select id="nuevoPuesto">
                        <option value="auxiliar">Auxiliar de Tienda</option>
                        <option value="repartidor">Repartidor</option>
                        <option value="encargado">Encargado</option>
                        <option value="limpieza">Limpieza</option>
                    </select>
                    
                    <button class="btn btn-secondary" id="btnAgregarUsuario">
                        <i class="fas fa-plus"></i> Agregar
                    </button>
                </div>
                
                <div class="table-responsive">
                    <div id="listaUsuarios">
                        <!-- Lista de usuarios se llenará con JavaScript -->
                    </div>
                </div>
            </div>
            
            <!-- Pestaña de Control de Ausencias -->
            <div class="tab-content" id="ausencias-tab">
                <h3><i class="fas fa-exclamation-triangle"></i> Control de Ausencias</h3>
                
                <div class="form-group">
                    <label for="selectUsuarioAusencia"><i class="fas fa-user"></i> Seleccionar Telepizzero</label>
                    <select id="selectUsuarioAusencia">
                        <!-- Opciones se llenarán con JavaScript -->
                    </select>
                    
                    <label for="fechaAusencia"><i class="fas fa-calendar-day"></i> Fecha</label>
                    <input type="date" id="fechaAusencia">
                    
                    <label for="tipoAusencia"><i class="fas fa-exclamation-circle"></i> Tipo</label>
                    <select id="tipoAusencia">
                        <option value="falta">❌ Falta</option>
                        <option value="ausencia_justificada">⚠️ Ausencia Justificada</option>
                        <option value="retraso">⏰ Retraso</option>
                    </select>
                    
                    <label for="motivoAusencia"><i class="fas fa-comment"></i> Motivo (opcional)</label>
                    <input type="text" id="motivoAusencia" placeholder="Motivo">
                    
                    <button class="btn btn-secondary" id="btnRegistrarAusencia">
                        <i class="fas fa-clipboard-check"></i> Registrar
                    </button>
                </div>
                
                <h4><i class="fas fa-clipboard-list"></i> Incidencias</h4>
                <div class="table-responsive">
                    <div id="listaAusencias">
                        <!-- Lista de ausencias se llenará con JavaScript -->
                    </div>
                </div>
            </div>
            
            <!-- Pestaña de Configuración de Correo -->
            <div class="tab-content" id="correo-tab">
                <h3><i class="fas fa-envelope"></i> Vinculación de Correo</h3>
                
                <div class="correo-info">
                    <h3><i class="fas fa-cogs"></i> Reportes Automáticos</h3>
                    <p>Vincule el correo para recibir reportes en formato PDF.</p>
                    <p>Correo por defecto: <strong>fichajetelepizza@outlook.es</strong></p>
                </div>
                
                <div class="form-group">
                    <label for="correoElectronico"><i class="fas fa-at"></i> Correo Electrónico</label>
                    <input type="email" id="correoElectronico" placeholder="fichajetelepizza@outlook.es" value="fichajetelepizza@outlook.es">
                    
                    <button class="btn btn-success" id="btnGuardarCorreo">
                        <i class="fas fa-save"></i> Guardar Correo
                    </button>
                </div>
                
                <div class="correo-info" id="infoCorreoGuardado">
                    <!-- Información del correo guardado se mostrará aquí -->
                </div>
                
                <div class="form-group">
                    <h4><i class="fas fa-paper-plane"></i> Enviar Reportes Manualmente</h4>
                    <p class="info-ayuda">Los reportes se enviarán en formato PDF al correo vinculado</p>
                    <div class="botones-envio">
                        <button class="btn btn-reporte" id="btnEnviarDiarioManual">
                            <i class="fas fa-file-pdf"></i> Enviar Diario
                        </button>
                        <button class="btn btn-reporte" id="btnEnviarSemanalManual">
                            <i class="fas fa-file-pdf"></i> Enviar Semanal
                        </button>
                        <button class="btn btn-gris" id="btnEnviarMensualManual">
                            <i class="fas fa-file-pdf"></i> Enviar Mensual
                        </button>
                    </div>
                </div>
                
                <div class="mensaje" id="mensajeCorreo"></div>
            </div>
            
            <!-- Pestaña de Gestión Semanal -->
            <div class="tab-content" id="semanas-tab">
                <h3><i class="fas fa-calendar-week"></i> Gestión Semanal</h3>
                
                <div class="form-group">
                    <label for="selectSemana"><i class="fas fa-calendar-alt"></i> Seleccionar Semana</label>
                    <select id="selectSemana">
                        <!-- Opciones se llenarán con JavaScript -->
                    </select>
                    
                    <label for="selectPuestoSemana"><i class="fas fa-filter"></i> Filtrar por Puesto</label>
                    <select id="selectPuestoSemana">
                        <option value="">Todos los puestos</option>
                        <option value="auxiliar">Auxiliar de Tienda</option>
                        <option value="repartidor">Repartidor</option>
                        <option value="encargado">Encargado</option>
                        <option value="limpieza">Limpieza</option>
                    </select>
                </div>
                
                <div id="infoSemana">
                    <div class="semana-info">
                        <h4><i class="fas fa-chart-bar"></i> Resumen Semanal</h4>
                        <div id="resumenSemanal"></div>
                    </div>
                    
                    <div class="table-responsive">
                        <table id="tablaSemanal">
                            <thead>
                                <tr>
                                    <th><i class="fas fa-user"></i> Nombre</th>
                                    <th><i class="fas fa-briefcase"></i> Puesto</th>
                                    <th><i class="fas fa-clock"></i> Total Horas</th>
                                    <th><i class="fas fa-calendar-check"></i> Días Trabajados</th>
                                    <th><i class="fas fa-chart-line"></i> Promedio Diario</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- Datos semanales se llenarán con JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <div class="botones-reporte">
                    <button class="btn btn-success" id="btnExportarSemanal">
                        <i class="fas fa-download"></i> Exportar Semana
                    </button>
                    <button class="btn btn-reporte" id="btnEnviarReporteSemanaSeleccionada">
                        <i class="fas fa-file-pdf"></i> Enviar Reporte PDF
                    </button>
                </div>
            </div>
            
            <button class="btn volver-btn" id="volverRegistro">
                <i class="fas fa-arrow-left"></i> Volver al Menú
            </button>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/emailjs-com@3/dist/email.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
    <script src="data.js"></script>
    <script src="email.js"></script>
    <script src="app.js"></script>
</body>
</html>